stubby-front-end
=========
> `stubby-front-end` - готовый минимальный набор кода необходимый для быстрого и легкого старта разработки front-end-а
 на стеке технологий: gulp, webpack, babel, reactjs, stylus, mocha

#### Основные возможности и особенности:

 * сборка js-кода webpack-ом
 * сборка stylus
 * сборка спрайтов и стилей для них
 * сборка svg-иконок в отдельный ttf/eot/woff-шрифт и генерация стилей для него
 * вставка изображений в base64-кодировке
 * отслеживание изменений кода и автоматическая пересборка проекта
 * локальный сервер с автообновление страницы в браузере
 * возможность создавать отдельные независимые ui-компоненты
 * проверка написанного кода инструментами: jscs, eslint, stylint
 * подготовка кода для продакшен использования: минификация js, css, html; ревизия url-ов; сжатие изображений
 * утилита 'scaffolder' для быстрого создание новых файлов, частей проекта из командой строки
 * набор готовых git-hook-ов и простое добавление новых

Требования к системе
------------

 * unix-base OS
 * nodejs 0.12+
 * npm 2.14+

Установка
------------

Полная установка на OS семейства debian/ubuntu.  
Установите `git`, `curl`, `nodejs`, `npm`:

``` bash
$ apt-get update && apt-get -y install \
    software-properties-common \
    curl \
    git-core && \
  curl -sL https://deb.nodesource.com/setup_4.x | sudo -E bash - && \
    apt-get -y install nodejs && \
  npm install -g npm@latest
```

Установите нужные для работы проекта зависимости:

``` bash
$ apt-get update && apt-get install -y \
    libpng-dev \
    libcairo2-dev \
    libjpeg8-dev \
    libpango1.0-dev \
    libgif-dev \
    build-essential \
    g++ && \
  npm install -g \
    node-gyp \
    gulp \
    jscs \
    esprima-fb@latest \
    eslint \
    babel-eslint \
    eslint-plugin-react
```

Клонируем репозиторий и подтягиваем зависимоти:

``` bash
$ git clone https://github.com/webnova-ru/stubby-front-end.git dirName && \
  cd dirName && \
  git remote set-url origin https://github.com/yourGitName/yourProject && \
  npm install && \
  npm run set-tools
```
`dirName` - имя папки куда клонируется проект,  
`https://github.com/yourGitName/yourProject` - url вашего будущего проекта

Руководство по использованию
------------
Структура проекта:
```
    .
    ├── _dest                        # результаты сборки проекта
    ├── _release                     # результаты сборки для продакшен использования
    ├── _temp                        # временные файлы
    ├── gulp                         # содержит всё что касается gulp-а
    │   ├── config                   # конфиги сборки проекта
    │   │   ├── index.js             # конфиг gulp-а
    │   │   ├── scaffolding.js       # конфиг утилиты scaffolder
    │   │   ├── sprites.js           # конфиг сборки спрайтов
    │   │   └── webpack.js           # конфиг webpack-а
    │   ├── lib                      # необходимые модули и библиотеки для работы gulp
    │   ├── tasks                    # задачи gulp-а
    │   └── index.js                 # "входная/отправная" точка запуска gulp-а
    ├── scaffolding                  # шаблоны задач утилиты scaffolder
    ├── scripts                      # скрипты с правами на выполнение
    │   ├── bin                      # скрипты, которые запускаются из командой строки
    │   └── git-hooks                # содержит различные git-hook-и
    ├── src                          # код, который выполняется на клиенте
    │   ├── components               # содержит директории с компонентами проекта
    │   │   ├── compName             # компонент со всем необходимым для него кодом
    │   │   │   ├── compName.js      # js-код компонента
    │   │   │   ├── compName.styl    # stylus-код компонента
    │   │   │   └── media            # подключаемые ресурсы компонента
    │   │   │       ├── base64       # картинки, которые должны вставляться через кодировку base-64
    │   │   │       ├── iconfont     # .svg для создания иконочного шрифта
    │   │   │       ├── img          # произвольные изобразения
    │   │   │       └── sptites      # изображения для спрайтов
    │   │   └── ...
    |   ├── html                     # html страницы
    |   ├── js                       # js-код
    │   │   ├── ...
    │   │   ├── lib                  # модули и библиотеки
    │   │   │   ├── shared           # js-код, который может работать как на front-end-е, так и back-end-е
    │   │   │   └── ...
    │   │   └── index.js             # "входная/отправная" точка запуска js на клиенте
    |   ├── media                    # подключаемые ресурсы
    │   │   ├── base64               # картинки, которые должны вставляться через кодировку base-64
    │   │   ├── iconfont             # .svg для создания иконочного шрифта
    │   │   ├── img                  # произвольные изобразения
    │   │   └── sptites              # изображения для спрайтов
    |   ├── stylus                   # стили
    │   │   ├── common               # общие стили страниц
    │   │   ├── globalMods           # глобальные модификаторы
    │   │   ├── mixins               # stylus миксины и функции
    │   │   ├── project              # произвольные стили проекта
    │   │   ├── index.styl           # "входная/отправная" точка компиляции stylus-а
    │   │   └── vars.styl            # переменные stylus-а
    |   └── templates                # шаблоны для временных файлов
    └── ...
```
> Файлы и директории начинающиеся на `_` являются сгенерированными. 
Директории `__test__` - содержат в себе unit-теcты, `__docs__` - несут в себе справочную информацию.

Основные команды:  
`gulp build` - сборка проекта  
`gulp dev` - сборка проекта в режиме разработки (отслеживание файлов, пересборка, автообновление страницы)  
`npm run release` - сборка проекта готового для продакшен использования  
`gulp --tasks` - посмотреть все такси системы  
`scaffolder` - создание заготовки для файла на основе шаблона

Работа со спрайтами:  
1. Создадим новую директорию с именем нового спрайта в папке `src/media/sprites`:
``` bash
$ mkdir ./src/media/sprites/newSpriteName
```  
2. Добавьте изображения в эту новую директорию:
``` bash
$ cp -a ~/yourFolder/withImages ./src/media/sprites/newSpriteName
```  
3. Подключим спрайт в стилях:
``` stylus
.someClassName
  sprite('newSpriteName', 'imageNameFromNewSpriteDir')
```  
4. Пересоберем стили: `gulp stylus`. Все, спрайт работает.

Работа с иконочными шрифтами:  
1. Добавьте новую svg-иконку формата 500x500px в директорию `src/media/iconfont/appIcons`:
``` bash
$ cp ~/yourFolder/withSvgIcons/icon.svg ./src/media/iconfont/appIcons/iconName.svg
```  
2. Используем иконку на странице:
``` html
<span class="icon icon_iconName"></span>
```  
3. Пересоберем иконки и стили: `gulp iconfont && gulp stylus`.

Вставка изображения на страницу в base64-кодировке:  
1. Добавьте изображение в директорию `src/media/base64`:
``` bash
$ cp ~/yourFolder/withImages/img.png ./src/media/base64/imgName.png
```  
2. Подключим изображение в стилях:
``` stylus
.someClassName
  background: base64('imgName.png') center center no-repeat
```  
3. Пересоберем стили: `gulp stylus`.

Работа со stylus-ом:  
Все стили проекта должны располагаться в директории `src/stylus/project`, либо в `src/components/compName/*.styl`, 
если это компонент интерфейса. Каждый stylus-файл запускается в своей области видимости и не имеет доступа к переменным 
других файлов, но имеет доступ к единственному глобальному объекту `$G`, который располагается в файле `src/stylus/vars.styl`.
Собрать стили можно командой `gulp stylus`.
    
Создание нового компонента интерфейса:  
1. Создадим новую папку с именем нового компонента в директории `src/components`:
``` bash
$ mkdir ./src/components/newCompName
```  
2. Добавим встраиваемые ресурсы(изображения, иконки, спрайты и др.) компоненту если это необходимо:
``` bash
$ mkdir -p ./src/components/newCompName/media/{img,base64,sprites,iconfont}
```  
3. Создадим и добавим js и stylus код компонента:
``` bash
$ touch newCompName.js newCompName.styl
```  
newCompName.js  
``` js
import 'newCompName.styl'; // подключаем стили компонента
// код компонента
```
newCompName.styl  
```
// stylus-код компонента
.newCompName__item
  padding: $G.unit // компонент имеет доступ к глобальному объекту '$G' из 'src/stylus/vars.styl'
```
По-умолчанию в проекте приводится в качестве примера компонент на шаблонизаторе reactjs. 
По вашему усмотрению, можно использовать любой ваш любимый шаблонизатора.

Использование скафолдера
------------
Для работы scaffolder-а из командной строки, необходимо чтобы в вашей переменной окружения `$PATH`
была строка `./node_modules/.bin`, если её нет, выполните:

``` bash
$ echo $PATH | grep './node_modules/.bin' > /dev/null && echo 'export $PATH=./node_modules/.bin:$PATH' >> ~/.bashrc
```
если вы используете не bash, то вместо `~/.bashrc` нужно указывать другой путь.\s

Кроме этого, убедитесь в наличии symlink-а под именем 'scaffolder' в директории `./node_modules/.bin`, выполните:
``` bash
$ ls $(npm bin) | grep 'scaffolder' > /dev/null || npm run ln-scaffolder
```

Для лёгкой работы c скафолдером достаточно выполнить в командой строке:
``` bash
$ scaffolder
```

Справка по работе утилиты `scaffolder -h`:
```
scaffolder [-h | --help] [-v | --version] [<имя команды>] [<имя создаваемого файла>] [<дополнительные параметры>]

-h, --help                      Справка по работе утилиты
-v, --version                   Узнать версию утилиты
<имя команды>                   Имя команды из конфигурационного файла скафолдера
<имя создаваемого файла>        Имя файла, в который будет записан результат команды
<дополнительные параметры>      Дополнительные параметры через пробел, которые будут переданы в шаблон
```

**Создание новой команды для скафолдера:**

1. Откроем конфигурационный файл по пути `gulp/config/scaffolding`

2. Добавим информацию о новой команде, например так:
``` js
    'ourNewCommand': { // имя команды
        info: 'наша новая команда для скафолдера', // описание команды
        templates: { // описание шаблонов которые нужно использовать, можно указать массив объектов
            name: 'tplName.js.template', // имя шаблона
            ext: 'js', // расширение которое будет дано результирующему файлу
            dest: 'path/to/resultCompileTpl' // путь куда "ляжет" результат компиляции шаблона
        }
    }
```  
3. Создадим шаблон для команды в директории `scaffolding`:
``` bash
$ echo 'тело шаблона,...<%= author %>' > ./scaffolding/tplName.js.template
```
по-умолчанию используется lodash-движок рендринга шаблонов. 
В своих шаблонах вы можете использовать заранее подготовленные переменные:  
`<%= author %>` -- имя выполнившего команду скафолдера (берется на основе `process.env.USER`)  
`<%= created %>` -- дата создания файла  
`<%= fileName %>` -- имя создаваемого файла  
`<%= fileDir %>` -- путь до папки с файлом  
`<%= file %>` -- полное название файла: 'путь до файла' + 'имя файла' + расширение  
`<%= fileWithoutExt %>` -- 'путь до файла' + 'имя файла'  
`<%= params[0] %>` -- '<дополнительные параметры>' из командой строки  
`<%= params[1] %>`

4. Запустим выполнение новой команды:
``` bash
$ scaffolder ourNewCommand fileName
```
или проcто:
``` bash
$ scaffolder
```
и выберем нашу команду из списка, далее следуем инструкциям в командной строке

примечание:  
Вы можете указывать отностительный путь вместо '<имя создаваемого файла>', 
тем самым легко создавать файлы в нужной директории, например так:
``` bash
$ scaffolder js-node ./relative/path/to/my_new_file.js
```

Использование Git-hook-ов
------------
В проекте имеется возможность быстро и легко создавать git-hook-и. 
Исходные коды всех хуков находятся в директории `scripts/git-hooks`. Каждая папка в этой директории имеет имя 
определенного хука и содержит в себе список файлов произвольного называния, которые будут выполяться по цепи. 
Если хоть один файл из этого списка выйдет с кодом ошибки, то весь git-hook выйдет с кодом ошибки.  

**Рассмотрим пример создания `post-commit` хука:**  
1. Создадим новую директорию в папке `scripts/git-hooks` с именем нашего хука(`post-commit`):
``` bash
$ mkdir ./scripts/git-hooks/post-commit && cd !$
```  
2. Создадим файл с произвольным именем:
``` bash
$ echo '...код хука... exit 0' > someFileName.sh
```  
3. Наделим этот файл правами на выполнение:
``` bash
$ chmod +x someFileName.sh
```  
4. Выполним инициализацию git-hook-ов в системе:
``` bash
$ npm run git-hooks
```
Всё, после этого ваш новый хук должен работать.

Кроме этого имеется ряд уже готовых хуков, а именно:  
* post-merge
    * Обновление зависимостей npm, bower
* pre-commit
    * Запрет коммитить в ветки: 'master', 'develop', 'dev'
    * Запрет коммитить, если в файлах остались следы от мерж-конфликтов
    * Запуск unit-тестов и запрет коммитить, если тесты были провалены
    * Запуск валидации кода инструментами: jscs, eslint, stylint. Запрет на коммит, если валидация провалена
* pre-push
    * Запрет пушить с форсом ветки: 'master', 'develop', 'dev', 'release-*', 'patch-*'
